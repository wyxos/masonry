(function(e,d){typeof exports=="object"&&typeof module<"u"?module.exports=d(require("vue")):typeof define=="function"&&define.amd?define(["vue"],d):(e=typeof globalThis<"u"?globalThis:e||self,e.WyxosMasonry=d(e.Vue))})(this,function(e){"use strict";const d=(u,g)=>{const c=u.__vccOpts||u;for(const[a,r]of g)c[a]=r;return c},k={key:0,class:"text-center"},h=["data-index"],B=["src","alt"],P=["onClick"],v={key:1},b=["disabled"];return d({__name:"WyxosMasonry",props:{load:Function,loadNext:Function,loadPrevious:Function,pages:Array,canLoadMore:Boolean},emits:["updatePages"],setup(u,{emit:g}){const c=g,a=e.ref(!1),r=e.ref(""),s=u,m=e.ref(null),f=e.ref(null),_=e.ref(!1);let p=null;e.onMounted(async()=>{var n;const o=await((n=s.load)==null?void 0:n.call(s));o&&c("updatePages",[o]),_.value=!0,f.value&&(p=new IntersectionObserver(E,{root:m.value,threshold:.8}),p.observe(f.value))}),e.onBeforeUnmount(()=>{f.value&&p&&p.disconnect()});const E=o=>{o.forEach(n=>{n.isIntersecting&&s.canLoadMore&&!a.value&&x()})},x=async()=>{var n;if(a.value)return;a.value=!0,r.value="next";const o=await((n=s.loadNext)==null?void 0:n.call(s));if(o){const t=[...s.pages,o];if(c("updatePages",t),await e.nextTick(),a.value=!1,r.value="",t.length>5){const l=t.slice(1);c("updatePages",l)}}else a.value=!1,r.value=""},M=e.computed(()=>s.pages.reduce((o,n)=>{let t=n.items.map((l,i)=>(l.page=n.page,l.pageIndex=i,l));return o.concat(t)},[])),y=o=>{const n=o.pageIndex,t=o.page,l=s.pages.map(i=>(i.page===t&&i.items.splice(n,1),i));c("updatePages",l)};return(o,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"infiniteScroll",ref:m,class:"infinite-scroll flex-1 flex flex-col overflow-x-hidden overflow-y-auto custom-scroll"},[a.value&&r.value==="previous"?(e.openBlock(),e.createElementBlock("p",k,"Loading previous content...")):e.createCommentVNode("",!0),e.createVNode(e.TransitionGroup,{class:"grid grid-cols-6 gap-4 infinite-scroll-content relative",tag:"div",name:"list"},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(M.value,(t,l)=>(e.openBlock(),e.createElementBlock("div",{key:t.key,"data-index":t.pageIndex,class:"grid-item"},[e.renderSlot(o.$slots,"item",{item:t,onRemove:y},()=>[e.createElementVNode("img",{src:t.src,alt:t.title},null,8,B),e.createElementVNode("button",{onClick:i=>y(t)},"Remove",8,P)],!0)],8,h))),128))]),_:3}),_.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("p",v,"Loading content...")),e.createElementVNode("button",{ref_key:"loadMoreButton",ref:f,onClick:x,disabled:a.value,class:"load-more-button"},e.toDisplayString(a.value?"Loading next content...":"Load more"),9,b)],512))}},[["__scopeId","data-v-b49e30c0"]])});
