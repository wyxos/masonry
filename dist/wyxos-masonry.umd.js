(function(e,u){typeof exports=="object"&&typeof module<"u"?module.exports=u(require("vue")):typeof define=="function"&&define.amd?define(["vue"],u):(e=typeof globalThis<"u"?globalThis:e||self,e.WyxosMasonry=u(e.Vue))})(this,function(e){"use strict";const u=(l,m)=>{const i=l.__vccOpts||l;for(const[s,c]of m)i[s]=c;return i},h=["data-index"],k=["src","alt"],S=["onClick"],b=["disabled"];return u({__name:"WyxosMasonry",props:{load:Function,loadNext:Function,loadPrevious:Function,pages:Array,canLoadMore:Boolean,containerClass:{type:String,default:"infinite-scroll flex-1 flex flex-col overflow-x-hidden overflow-y-auto custom-scroll"},buttonClass:{type:String,default:"load-more-button"},loaderClass:{type:String,default:"text-center"},gridItemClass:{type:String,default:"grid-item"},cacheSize:{type:Number,default:5}},emits:["updatePages"],setup(l,{emit:m}){const i=m,s=e.ref(!1),c=e.ref(""),a=l,p=e.ref(null),f=e.ref(null),y=e.ref(!1);let g=null;e.onMounted(async()=>{var o;const t=await((o=a.load)==null?void 0:o.call(a));t&&i("updatePages",[t]),y.value=!0,f.value&&(g=new IntersectionObserver(N,{root:p.value,threshold:.8}),g.observe(f.value))}),e.onBeforeUnmount(()=>{f.value&&g&&g.disconnect()});const N=t=>{t.forEach(o=>{o.isIntersecting&&a.canLoadMore&&!s.value&&x()})},x=async()=>{var o;if(s.value)return;s.value=!0,c.value="next";const t=await((o=a.loadNext)==null?void 0:o.call(a));if(t){const n=[...a.pages,t];if(i("updatePages",n),await e.nextTick(),s.value=!1,c.value="",n.length>a.cacheSize){const r=n.slice(1);i("updatePages",r)}}else s.value=!1,c.value=""},P=e.computed(()=>a.pages.reduce((t,o)=>{let n=o.items.map((r,d)=>(r.page=o.page,r.pageIndex=d,r));return t.concat(n)},[])),C=t=>{const o=t.pageIndex,n=t.page,r=a.pages.map(d=>(d.page===n&&d.items.splice(o,1),d));i("updatePages",r)};return(t,o)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"infiniteScroll",ref:p,class:e.normalizeClass(l.containerClass)},[s.value&&c.value==="previous"?e.renderSlot(t.$slots,"loader",{key:0},()=>[e.createElementVNode("p",{class:e.normalizeClass(l.loaderClass)},"Loading previous content...",2)],!0):e.createCommentVNode("",!0),e.createVNode(e.TransitionGroup,{class:"grid grid-cols-6 gap-4 infinite-scroll-content relative",tag:"div",name:"w-masonry-list"},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(P.value,(n,r)=>(e.openBlock(),e.createElementBlock("div",{key:n.key,"data-index":n.pageIndex,class:e.normalizeClass(l.gridItemClass)},[e.renderSlot(t.$slots,"item",{item:n,onRemove:C},()=>[e.createElementVNode("img",{src:n.src,alt:n.title},null,8,k),e.createElementVNode("button",{onClick:d=>C(n)},"Remove",8,S)],!0)],10,h))),128))]),_:3}),y.value?e.createCommentVNode("",!0):e.renderSlot(t.$slots,"loader",{key:1},()=>[e.createElementVNode("p",{class:e.normalizeClass(l.loaderClass)},"Loading content...",2)],!0),e.renderSlot(t.$slots,"load-more-button",{},()=>[e.createElementVNode("button",{ref_key:"loadMoreButton",ref:f,onClick:x,disabled:s.value,class:e.normalizeClass(l.buttonClass)},e.toDisplayString(s.value?"Loading next content...":"Load more"),11,b)],!0)],2))}},[["__scopeId","data-v-dc36e1e0"]])});
