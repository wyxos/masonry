(function(d,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(d=typeof globalThis<"u"?globalThis:d||self,e(d.WyxosMasonry={},d.Vue))})(this,function(d,e){"use strict";const h=(l,g)=>{const i=l.__vccOpts||l;for(const[s,c]of g)i[s]=c;return i},V=["data-index"],k=["src","alt"],S=["onClick"],b=["disabled"],N=h({__name:"WyxosMasonry",props:{load:Function,loadNext:Function,loadPrevious:Function,modelValue:Array,canLoadMore:Boolean,containerClass:{type:String,default:"infinite-scroll flex-1 flex flex-col overflow-x-hidden overflow-y-auto custom-scroll"},buttonClass:{type:String,default:"load-more-button"},loaderClass:{type:String,default:"text-center"},gridItemClass:{type:String,default:"grid-item"},cacheSize:{type:Number,default:5},primaryKey:"id"},emits:["update:modelValue"],setup(l,{emit:g}){const i=g,s=e.ref(!1),c=e.ref(""),a=l,p=e.ref(null),f=e.ref(null),y=e.ref(!1);let m=null;e.onMounted(async()=>{var n;const t=await((n=a.load)==null?void 0:n.call(a));t&&i("update:modelValue",[t]),y.value=!0,f.value&&(m=new IntersectionObserver(_,{root:p.value,threshold:.8}),m.observe(f.value))}),e.onBeforeUnmount(()=>{f.value&&m&&m.disconnect()});const _=t=>{t.forEach(n=>{n.isIntersecting&&a.canLoadMore&&!s.value&&x()})},x=async()=>{var n;if(s.value)return;s.value=!0,c.value="next";const t=await((n=a.loadNext)==null?void 0:n.call(a));if(t){const o=[...a.pages,t];if(i("update:modelValue",o),await e.nextTick(),s.value=!1,c.value="",o.length>a.cacheSize){const r=o.slice(1);i("update:modelValue",r)}}else s.value=!1,c.value=""},B=e.computed(()=>a.modelValue.reduce((t,n)=>{let o=n.items.map((r,u)=>(r.page=n.page,r.pageIndex=u,r));return t.concat(o)},[])),C=t=>{const n=t.pageIndex,o=t.page,r=a.modelValue.map(u=>(u.page===o&&u.items.splice(n,1),u));i("update:modelValue",r)};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"infiniteScroll",ref:p,class:e.normalizeClass(l.containerClass)},[s.value&&c.value==="previous"?e.renderSlot(t.$slots,"loader",{key:0},()=>[e.createElementVNode("p",{class:e.normalizeClass(l.loaderClass)},"Loading previous content...",2)],!0):e.createCommentVNode("",!0),e.createVNode(e.TransitionGroup,{class:"grid grid-cols-6 gap-4 infinite-scroll-content relative",tag:"div",name:"w-masonry-list"},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.value,(o,r)=>(e.openBlock(),e.createElementBlock("div",{key:`${o[l.primaryKey]}`,"data-index":o.pageIndex,class:e.normalizeClass(l.gridItemClass)},[e.renderSlot(t.$slots,"item",{item:o,onRemove:C},()=>[e.createElementVNode("img",{src:o.src,alt:o.title},null,8,k),e.createElementVNode("button",{onClick:u=>C(o)},"Remove",8,S)],!0)],10,V))),128))]),_:3}),y.value?e.createCommentVNode("",!0):e.renderSlot(t.$slots,"loader",{key:1},()=>[e.createElementVNode("p",{class:e.normalizeClass(l.loaderClass)},"Loading content...",2)],!0),e.renderSlot(t.$slots,"load-more-button",{},()=>[e.createElementVNode("button",{ref_key:"loadMoreButton",ref:f,onClick:x,disabled:s.value,class:e.normalizeClass(l.buttonClass)},e.toDisplayString(s.value?"Loading next content...":"Load more"),11,b)],!0)],2))}},[["__scopeId","data-v-fe48de8f"]]);d.default=N,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
