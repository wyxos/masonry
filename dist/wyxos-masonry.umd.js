(function(d,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(d=typeof globalThis<"u"?globalThis:d||self,e(d.WyxosMasonry={},d.Vue))})(this,function(d,e){"use strict";const V=(l,g)=>{const i=l.__vccOpts||l;for(const[s,c]of g)i[s]=c;return i},h=["data-index"],k=["src","alt"],b=["onClick"],S=["disabled"],N=V({__name:"WyxosMasonry",props:{load:Function,loadNext:Function,loadPrevious:Function,modelValue:Array,canLoadMore:Boolean,containerClass:{type:String,default:"infinite-scroll flex-1 flex flex-col overflow-x-hidden overflow-y-auto custom-scroll"},buttonClass:{type:String,default:"load-more-button"},loaderClass:{type:String,default:"text-center"},gridItemClass:{type:String,default:"grid-item"},cacheSize:{type:Number,default:5},primaryKey:"id"},emits:["update:modelValue"],setup(l,{emit:g}){const i=g,s=e.ref(!1),c=e.ref(""),o=l,p=e.ref(null),m=e.ref(null),y=e.ref(!1);let f=null;e.onMounted(async()=>{var a;const t=await((a=o.load)==null?void 0:a.call(o));t&&i("update:modelValue",[t]),y.value=!0,m.value&&(f=new IntersectionObserver(_,{root:p.value,threshold:.8}),f.observe(m.value))}),e.onBeforeUnmount(()=>{m.value&&f&&f.disconnect()});const _=t=>{t.forEach(a=>{a.isIntersecting&&o.canLoadMore&&!s.value&&x()})},x=async()=>{var a;if(s.value)return;s.value=!0,c.value="next";const t=await((a=o.loadNext)==null?void 0:a.call(o));if(t){if([...o.modelValue,t].length>o.cacheSize){const r=o.modelValue.slice(1);i("update:modelValue",r)}await e.nextTick();const n=[...o.modelValue,t];i("update:modelValue",n),s.value=!1,c.value=""}else s.value=!1,c.value=""},B=e.computed(()=>o.modelValue.reduce((t,a)=>{let n=a.items.map((r,u)=>(r.page=a.page,r.pageIndex=u,r));return t.concat(n)},[])),C=t=>{const a=t.pageIndex,n=t.page,r=o.modelValue.map(u=>(u.page===n&&u.items.splice(a,1),u));i("update:modelValue",r)};return(t,a)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"infiniteScroll",ref:p,class:e.normalizeClass(l.containerClass)},[s.value&&c.value==="previous"?e.renderSlot(t.$slots,"loader",{key:0},()=>[e.createElementVNode("p",{class:e.normalizeClass(l.loaderClass)},"Loading previous content...",2)],!0):e.createCommentVNode("",!0),e.createVNode(e.TransitionGroup,{class:"grid grid-cols-6 gap-4 infinite-scroll-content relative",tag:"div",name:"w-masonry-list"},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.value,(n,r)=>(e.openBlock(),e.createElementBlock("div",{key:`${n[l.primaryKey]}`,"data-index":n.pageIndex,class:e.normalizeClass(l.gridItemClass)},[e.renderSlot(t.$slots,"item",{item:n,onRemove:C},()=>[e.createElementVNode("img",{src:n.src,alt:n.title},null,8,k),e.createElementVNode("button",{onClick:u=>C(n)},"Remove",8,b)],!0)],10,h))),128))]),_:3}),y.value?e.createCommentVNode("",!0):e.renderSlot(t.$slots,"loader",{key:1},()=>[e.createElementVNode("p",{class:e.normalizeClass(l.loaderClass)},"Loading content...",2)],!0),e.renderSlot(t.$slots,"load-more-button",{},()=>[e.createElementVNode("button",{ref_key:"loadMoreButton",ref:m,onClick:x,disabled:s.value,class:e.normalizeClass(l.buttonClass)},e.toDisplayString(s.value?"Loading next content...":"Load more"),11,S)],!0)],2))}},[["__scopeId","data-v-6edafba2"]]);d.default=N,Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
