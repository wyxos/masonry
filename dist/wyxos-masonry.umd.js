(function(i,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(i=typeof globalThis<"u"?globalThis:i||self,e(i.WyxosMasonry={},i.Vue))})(this,function(i,e){"use strict";const h=(l,m)=>{const c=l.__vccOpts||l;for(const[s,d]of m)c[s]=d;return c},k=["data-index"],S=["src","alt"],b=["onClick"],_=["disabled"],N=h({__name:"WyxosMasonry",props:{load:Function,loadNext:Function,loadPrevious:Function,pages:Array,canLoadMore:Boolean,containerClass:{type:String,default:"infinite-scroll flex-1 flex flex-col overflow-x-hidden overflow-y-auto custom-scroll"},buttonClass:{type:String,default:"load-more-button"},loaderClass:{type:String,default:"text-center"},gridItemClass:{type:String,default:"grid-item"},cacheSize:{type:Number,default:5}},emits:["updatePages"],setup(l,{emit:m}){const c=m,s=e.ref(!1),d=e.ref(""),a=l,p=e.ref(null),f=e.ref(null),y=e.ref(!1);let g=null;e.onMounted(async()=>{var o;const t=await((o=a.load)==null?void 0:o.call(a));t&&c("updatePages",[t]),y.value=!0,f.value&&(g=new IntersectionObserver(P,{root:p.value,threshold:.8}),g.observe(f.value))}),e.onBeforeUnmount(()=>{f.value&&g&&g.disconnect()});const P=t=>{t.forEach(o=>{o.isIntersecting&&a.canLoadMore&&!s.value&&x()})},x=async()=>{var o;if(s.value)return;s.value=!0,d.value="next";const t=await((o=a.loadNext)==null?void 0:o.call(a));if(t){const n=[...a.pages,t];if(c("updatePages",n),await e.nextTick(),s.value=!1,d.value="",n.length>a.cacheSize){const r=n.slice(1);c("updatePages",r)}}else s.value=!1,d.value=""},B=e.computed(()=>a.pages.reduce((t,o)=>{let n=o.items.map((r,u)=>(r.page=o.page,r.pageIndex=u,r));return t.concat(n)},[])),C=t=>{const o=t.pageIndex,n=t.page,r=a.pages.map(u=>(u.page===n&&u.items.splice(o,1),u));c("updatePages",r)};return(t,o)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"infiniteScroll",ref:p,class:e.normalizeClass(l.containerClass)},[s.value&&d.value==="previous"?e.renderSlot(t.$slots,"loader",{key:0},()=>[e.createElementVNode("p",{class:e.normalizeClass(l.loaderClass)},"Loading previous content...",2)],!0):e.createCommentVNode("",!0),e.createVNode(e.TransitionGroup,{class:"grid grid-cols-6 gap-4 infinite-scroll-content relative",tag:"div",name:"w-masonry-list"},{default:e.withCtx(()=>[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(B.value,(n,r)=>(e.openBlock(),e.createElementBlock("div",{key:n.key,"data-index":n.pageIndex,class:e.normalizeClass(l.gridItemClass)},[e.renderSlot(t.$slots,"item",{item:n,onRemove:C},()=>[e.createElementVNode("img",{src:n.src,alt:n.title},null,8,S),e.createElementVNode("button",{onClick:u=>C(n)},"Remove",8,b)],!0)],10,k))),128))]),_:3}),y.value?e.createCommentVNode("",!0):e.renderSlot(t.$slots,"loader",{key:1},()=>[e.createElementVNode("p",{class:e.normalizeClass(l.loaderClass)},"Loading content...",2)],!0),e.renderSlot(t.$slots,"load-more-button",{},()=>[e.createElementVNode("button",{ref_key:"loadMoreButton",ref:f,onClick:x,disabled:s.value,class:e.normalizeClass(l.buttonClass)},e.toDisplayString(s.value?"Loading next content...":"Load more"),11,_)],!0)],2))}},[["__scopeId","data-v-dc36e1e0"]]);i.default=N,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
